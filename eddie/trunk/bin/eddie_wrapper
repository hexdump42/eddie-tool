#!/bin/sh
#
## Eddie wrapper script to make sure it keeps running!
## 990302 Chris Miles <cmiles@connect.com.au>

# Exit if host is called 'testjump*'
host=`cat /etc/nodename`
echo $host | grep testjump
if [ $? = 0 ]; then
        exit 0
fi


RUNFILE=/var/run/eddie$$.out

while [ 1 ]; do
	cd /opt/eddie/bin
	./eddie.py >$RUNFILE 2>&1
	retcode=$?
	echo "eddie_wrapper: eddie died at `date` return code: $retcode" >> $RUNFILE
	/usr/bin/mailx -s "Eddie output on `hostname` at `date`" cmiles@connect.com.au < $RUNFILE
	/usr/bin/sleep 30
	echo "eddie_wrapper: restarting Eddie at `date`."
done

rm -f $RUNFILE
